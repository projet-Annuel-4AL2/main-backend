{% extends 'base.html' %}

{% block title %}
Profile
{% endblock %}

{% block content %}
<div class="gap-1 px-6 flex flex-1 justify-center py-5">
  <div class="layout-content-container flex flex-col w-80">
    <div class="flex p-4 @container">
      <div class="flex w-full flex-col gap-4 items-start">
        <div class="flex gap-4 flex-col items-start">
          <div
            class="bg-center bg-no-repeat aspect-square bg-cover rounded-full min-h-32 w-32"
            style='background-image: url("{{ user.profile_pic|default:'https://cdn.usegalileo.ai/sdxl10/67309561-9bfc-4860-a4c1-b13311b8356b.png' }}");'
          ></div>
          <div class="flex flex-col justify-center">
            <p class="text-[#FFFFFF] text-[22px] font-bold leading-tight tracking-[-0.015em]">{{ user.username }}</p>
            <p class="text-[#CBCBCB] text-base font-normal leading-normal">{{ user.bio|default:"don't have any bio" }}</p>
            <p class="text-[#CBCBCB] text-base font-normal leading-normal"> {{ user.followers|length }} Followers {{ followings.followings|length }} Followings</p>
          </div>
        </div>
      </div>
    </div>
      {% if messages %}
            <div class="bg-gray-500 text-white p-4 rounded-lg mb-4">
                {% for message in messages %}
                    <p>{{ message }}</p>
                {% endfor %}
            </div>
        {% endif %}
    <div class="pb-3">
      <div class="flex border-b border-[#434343] px-4 gap-8">
        <a class="flex flex-col items-center justify-center border-b-[3px] border-b-transparent text-[#CBCBCB] gap-1 pb-[7px] pt-2.5" href={% url 'feed'%}>
          <div class="text-[#CBCBCB]" data-icon="ShieldChevron" data-size="24px" data-weight="regular">
            <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor" viewBox="0 0 256 256">
              <path
                d="M208,40H48A16,16,0,0,0,32,56v58.77c0,89.61,75.82,119.34,91,124.39a15.53,15.53,0,0,0,10,0c15.2-5.05,91-34.78,91-124.39V56A16,16,0,0,0,208,40ZM128,224c-9.26-3.08-43.29-16.32-63.87-49.5L128,129.76l63.87,44.71C171.31,207.61,137.34,220.85,128,224Zm80-109.18c0,17.64-3.36,32.63-8.72,45.34l-66.69-46.68a8,8,0,0,0-9.18,0L56.72,160.13C51.36,147.42,48,132.43,48,114.79V56l160,0Z"
              ></path>
            </svg>
          </div>
          <p class="text-[#CBCBCB] text-sm font-bold leading-normal tracking-[0.015em]">Feed</p>
        </a>
        <a class="flex flex-col items-center justify-center border-b-[3px] border-b-transparent text-[#CBCBCB] gap-1 pb-[7px] pt-2.5" href={%url 'userSettings' user.username%}>
          <div class="text-[#CBCBCB]" data-icon="ToggleRight" data-size="24px" data-weight="regular">
            <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor" viewBox="0 0 256 256">
              <path
                d="M176,56H80a72,72,0,0,0,0,144h96a72,72,0,0,0,0-144Zm0,128H80A56,56,0,0,1,80,72h96a56,56,0,0,1,0,112Zm0-96a40,40,0,1,0,40,40A40,40,0,0,0,176,88Zm0,64a24,24,0,1,1,24-24A24,24,0,0,1,176,152Z"
              ></path>
            </svg>
          </div>
          <p class="text-[#CBCBCB] text-sm font-bold leading-normal tracking-[0.015em]">Settings</p>
        </a>
      </div>
    </div>
    <div class="flex items-center gap-4 bg-black px-4 min-h-14 justify-between">
    </div>
  </div>
  <div class="layout-content-container flex flex-col max-w-[960px] flex-1" style="margin-left: 100px;">
    <div class="flex flex-col gap-4 bg-black px-4 min-h-14">
      {% for post in posts %}
              <div class="p-2 @container">
                <div class="flex flex-col items-stretch justify-start rounded-xl @xl:flex-row @xl:items-start">
                  <div class="w-full aspect-video rounded-xl overflow-auto bg-gray-950 text-white p-4" style="max-height: 100000px; width:  120000px;">
                      <div id="code-{{ forloop.counter }}" style="height: 100%;" required></div>
                  </div>
                  <div class="flex w-full min-w-72 grow flex-col items-stretch justify-center gap-1 py-4 @xl:px-4">
                    <div class="flex items-end gap-3 justify-between">
                      <div class="flex flex-col gap-1">
                        <p class="text-[#CBCBCB] text-base font-normal leading-normal">
                        {{ post.content|truncatechars:600 }}
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              {% endfor %}
    </div>
</div>
</div>
</div>
{% endblock %}
{% block extra_js %}
<script>
    var require = { paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.26.1/min/vs' } };
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.26.1/min/vs/loader.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.26.1/min/vs/editor/editor.main.nls.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.26.1/min/vs/editor/editor.main.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<script>
    function initializeEditors() {
        {% for post in posts %}
            monaco.editor.create(document.getElementById('code-{{ forloop.counter }}'), {
                value: `{{ post.code|escapejs }}`,
                language: '{{ post.language }}',
                theme: 'vs-dark',
                readOnly: true
            });
        {% endfor %}
    }

    document.addEventListener('DOMContentLoaded', function() {
        initializeEditors();
    });

    function likePost(postId, userId) {
        var url = 'http://localhost:80/api/post/' + postId + '/add-like/';

        $.ajax({
            url: url,
            type: 'POST',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}'
            },
            data: {
                'user_id': userId,
            },
            success: function(response) {
                $('#post-container').load(location.href + ' #post-container > *', function() {
                    initializeEditors();
                });
            },
            error: function(xhr, status, error) {
                console.log(xhr.responseText);
            }
        });
    }
</script>
{% endblock %}