{% extends "base.html" %}

{% block title %}Home{% endblock %}

{% block content %}
        <div class="gap-1 px-6 flex flex-1 justify-center py-5">
          <div class="layout-content-container flex flex-col w-80">
            <div class="flex p-4 @container">
              <div class="flex w-full flex-col gap-4 items-start">
                <div class="flex gap-4 flex-col items-start">
                  <div
                    class="bg-center bg-no-repeat aspect-square bg-cover rounded-full min-h-32 w-32"
                    style='background-image: url("{{ user.profile_pic|default:'https://cdn.usegalileo.ai/sdxl10/67309561-9bfc-4860-a4c1-b13311b8356b.png' }}");'
                    ></div>
                  <div class="flex flex-col justify-center">
                    <p class="text-[#FFFFFF] text-[22px] font-bold leading-tight tracking-[-0.015em]">{{ user_info.name }}</p>
                    <p class="text-[#CBCBCB] text-base font-normal leading-normal">{{ user.bio|default:"don't have any bio" }}</p>
                    <p class="text-[#CBCBCB] text-base font-normal leading-normal"> {{ user.followers|length }} followers {{ followings.followings|length }} following</p>
                  </div>
                </div>
              </div>
            </div>
            <div class="flex h-full min-h-[700px] flex-col justify-between bg-black p-4">
              <div class="flex flex-col gap-4">
                <div class="flex gap-3">
                </div>
                <div class="flex flex-col gap-2">
                  <a href="{% url 'feed' %}">
                    <div class="flex items-center gap-3 px-3 py-2">
                      <div class="text-[#FFFFFF]" data-icon="ShieldChevron" data-size="24px" data-weight="regular">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor" viewBox="0 0 256 256">
                          <path
                            d="M208,40H48A16,16,0,0,0,32,56v58.77c0,89.61,75.82,119.34,91,124.39a15.53,15.53,0,0,0,10,0c15.2-5.05,91-34.78,91-124.39V56A16,16,0,0,0,208,40ZM128,224c-9.26-3.08-43.29-16.32-63.87-49.5L128,129.76l63.87,44.71C171.31,207.61,137.34,220.85,128,224Zm80-109.18c0,17.64-3.36,32.63-8.72,45.34l-66.69-46.68a8,8,0,0,0-9.18,0L56.72,160.13C51.36,147.42,48,132.43,48,114.79V56l160,0Z"
                          ></path>
                        </svg>
                      </div>
                      <p class="text-[#FFFFFF] text-sm font-medium leading-normal">Feed</p>
                    </div>
                  </a>
                  <a href="{% url 'explorer' %}">
                    <div class="flex items-center gap-3 px-3 py-2 ">
                      <div class="text-[#FFFFFF]" data-icon="DiscordLogo" data-size="24px" data-weight="fill">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor" viewBox="0 0 256 256">
                          <path
                            d="M247.51,174.39,218,58a16.08,16.08,0,0,0-13-11.88l-36.06-5.92a16.22,16.22,0,0,0-18.26,11.88l-.21.85a4,4,0,0,0,3.27,4.93,155.62,155.62,0,0,1,24.41,5.62,8.2,8.2,0,0,1,5.62,9.7,8,8,0,0,1-10.19,5.64,155.4,155.4,0,0,0-90.8-.1,8.22,8.22,0,0,1-10.28-4.81,8,8,0,0,1,5.08-10.33,156.85,156.85,0,0,1,24.72-5.72,4,4,0,0,0,3.27-4.93l-.21-.85A16.21,16.21,0,0,0,87.08,40.21L51,46.13A16.08,16.08,0,0,0,38,58L8.49,174.39a15.94,15.94,0,0,0,9.06,18.51l67,29.71a16.17,16.17,0,0,0,21.71-9.1l3.49-9.45a4,4,0,0,0-3.27-5.35,158.13,158.13,0,0,1-28.63-6.2,8.2,8.2,0,0,1-5.61-9.67,8,8,0,0,1,10.2-5.66,155.59,155.59,0,0,0,91.12,0,8,8,0,0,1,10.19,5.65,8.19,8.19,0,0,1-5.61,9.68,157.84,157.84,0,0,1-28.62,6.2,4,4,0,0,0-3.27,5.35l3.49,9.45a16.18,16.18,0,0,0,21.71,9.1l67-29.71A15.94,15.94,0,0,0,247.51,174.39ZM92,152a12,12,0,1,1,12-12A12,12,0,0,1,92,152Zm72,0a12,12,0,1,1,12-12A12,12,0,0,1,164,152Z"
                          ></path>
                        </svg>
                      </div>
                      <p class="text-[#FFFFFF] text-sm font-medium leading-normal">Explorer</p>
                    </div>
                  </a>
                  <a href="{% url 'users_' %}">
                    <div class="flex items-center gap-3 px-3 py-2">
                      <div class="text-[#FFFFFF]" data-icon="Bell" data-size="24px" data-weight="regular">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor" viewBox="0 0 256 256">
                          <path
                            d="M168,56a8,8,0,0,1,8-8h16V32a8,8,0,0,1,16,0V48h16a8,8,0,0,1,0,16H208V80a8,8,0,0,1-16,0V64H176A8,8,0,0,1,168,56Zm62.56,54.68a103.92,103.92,0,1,1-85.24-85.24,8,8,0,0,1-2.64,15.78A88.07,88.07,0,0,0,40,128a87.62,87.62,0,0,0,22.24,58.41A79.66,79.66,0,0,1,98.3,157.66a48,48,0,1,1,59.4,0,79.66,79.66,0,0,1,36.06,28.75A87.62,87.62,0,0,0,216,128a88.85,88.85,0,0,0-1.22-14.68,8,8,0,1,1,15.78-2.64ZM128,152a32,32,0,1,0-32-32A32,32,0,0,0,128,152Zm0,64a87.57,87.57,0,0,0,53.92-18.5,64,64,0,0,0-107.84,0A87.57,87.57,0,0,0,128,216Z"
                          ></path>
                        </svg>
                      </div>
                      <p class="text-[#FFFFFF] text-sm font-medium leading-normal">users</p>
                    </div>
                  </a>
                </div>
                <div class="flex flex-col gap-4">
                    <button
                      onclick="window.location.href = '{% url 'userPostAdd' %}'"
                      class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-full h-10 px-4 bg-[#FFFFFF] text-black text-sm font-bold leading-normal tracking-[0.015em]"
                    >
                      <span class="truncate">Add Posts</span>
                    </button>
                    <button
                      onclick="window.location.href = '{% url 'createGroupe' %}'"
                      class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-full h-10 px-4 bg-[#FFFFFF] text-black text-sm font-bold leading-normal tracking-[0.015em]"
                    >
                    <span class="truncate">Create Groupe</span>
                  </button>
                  <div class="flex flex-col gap-1">
                    {% for follower in followers.followers|slice:"8" %}
                      <div class="flex items-center gap-3 px-3 py-2">
                        <div class="text-[#FFFFFF]" data-icon="UserCircle" data-size="24px" data-weight="regular">
                          <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor" viewBox="0 0 256 256">
                            <path
                              d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24ZM74.08,197.5a64,64,0,0,1,107.84,0,87.83,87.83,0,0,1-107.84,0ZM96,120a32,32,0,1,1,32,32A32,32,0,0,1,96,120Zm97.76,66.41a79.66,79.66,0,0,0-36.06-28.75,48,48,0,1,0-59.4,0,79.66,79.66,0,0,0-36.06,28.75,88,88,0,1,1,131.52,0Z"
                            ></path>
                          </svg>
                        </div>
                        <a class="text-[#FFFFFF] text-sm font-medium leading-normal" href="{% url 'profil' follower.username %}">{{ follower.username}}</a>
                      </div>
                    {% endfor %}
                    <div class="flex justify-center items-center gap-3 px-3 py-2">
                      <a href="{% url 'followers' %}">
                        <button class="flex min-w-[280px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-full h-10 px-4 bg-[#FFFFFF] text-black text-sm font-bold leading-normal tracking-[0.015em]">
                          <span class="truncate">View All</span>
                        </button>
                      </a>
                    </div>
                  </div>
                </div>

              </div>
             
            </div>
          </div>
          
          <div class="layout-content-container flex flex-col max-w-[960px] flex-1">
            <div class="flex w-full overflow-hidden px-4 py-3">
              <div class="flex min-h-min flex-row items-start justify-start gap-3">
                {% for user in users|slice:":8"%}
                <div class="flex flex-1 flex-col justify-center gap-2 w-24 text-left">
                  <a href="{% url 'profil' user.username %}">
                    <div
                        class="w-full bg-center bg-no-repeat aspect-[3/5] bg-cover rounded-xl"
                        style='background-image: url("{{ user.profile_pic }}");'
                    ></div>
                </a>
                  <p class="text-[#FFFFFF] text-[13px] font-normal leading-normal">{{ user.username }}</p>
                </div>
                {% endfor %}
              </div>
            </div>
            {% if post is not None %}
            <div class="p-4 @container" id="post-container">
              <div class="flex flex-col items-stretch justify-start rounded-xl @xl:flex-row @xl:items-start">
                <div class="w-full aspect-video rounded-xl overflow-auto bg-gray-950 text-white p-4" style="max-height: 100000px; width:  120000px;">
                    <div id="code-editor" style="height: 100%;"></div>
                </div>
                <div class="flex w-full min-w-72 grow flex-col items-stretch justify-center gap-1 py-4 @xl:px-4">
                  <p class="text-[#CBCBCB] text-sm font-normal leading-normal">{{ post.created_at }}</p>
                  <p class="text-[#FFFFFF] text-lg font-bold leading-tight tracking-[-0.015em]">{{ post.author }}</p>
                  <div class="flex items-end gap-3 justify-between">
                    <div class="flex flex-col gap-1">
                      <p class="text-[#CBCBCB] text-base font-normal leading-normal">
                       {{ post.content|truncatechars:600 }}
                      </p>
                    <div class="flex items-center">
                        <button id="like" onclick="likePost({{ post.id }}, '{{ user.id }}')" class="flex items-center mr-4">
                            <svg class="w-6 h-6" fill="#FFFFFF" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                            </svg>
                            <span style="color: #808080;">{{ post.likes|length }} likes</span>
                        </button>
                    </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="pb-3">
              <div class="flex border-b border-[#434343] px-4 justify-between">
                <a href={% url 'groupes' %} class="flex flex-col items-center justify-center border-b-[3px] border-b-[#FFFFFF] text-[#FFFFFF] gap-1 pb-[7px] pt-2.5 flex-1" href="#">
                  <div class="text-[#FFFFFF]" data-icon="ArrowCircleRight" data-size="24px" data-weight="fill">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor" viewBox="0 0 256 256">
                      <path
                        d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm45.66,109.66-32,32a8,8,0,0,1-11.32-11.32L148.69,136H88a8,8,0,0,1,0-16h60.69l-18.35-18.34a8,8,0,0,1,11.32-11.32l32,32A8,8,0,0,1,173.66,133.66Z"
                      ></path>
                    </svg>
                  </div>
                  <p class="text-[#FFFFFF] text-sm font-bold leading-normal tracking-[0.015em]">View All Groupe</p>
                </a>
              </div>
            </div>
            {% endif %}
            <div class="px-4 py-3">
              <label class="flex flex-col min-w-40 h-12 w-full">
                <div class="flex w-full flex-1 items-stretch rounded-xl h-full">
                  <div
                    class="text-[#CBCBCB] flex border-none bg-[#333333] items-center justify-center pl-4 rounded-l-xl border-r-0"
                    data-icon="MagnifyingGlass"
                    data-size="24px"
                    data-weight="regular"
                  >
                    <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor" viewBox="0 0 256 256">
                      <path
                        d="M229.66,218.34l-50.07-50.06a88.11,88.11,0,1,0-11.31,11.31l50.06,50.07a8,8,0,0,0,11.32-11.32ZM40,112a72,72,0,1,1,72,72A72.08,72.08,0,0,1,40,112Z"
                      ></path>
                    </svg>
                  </div>
                  <input
                    id = "search"
                    placeholder="Search..."
                    class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-xl text-[#FFFFFF] focus:outline-0 focus:ring-0 border-none bg-[#333333] focus:border-none h-full placeholder:text-[#CBCBCB] px-4 rounded-l-none border-l-0 pl-2 text-base font-normal leading-normal"
                    value=""
                  />
                </div>
              </label>
            </div>
            <div id="allGroupe">
            {% for groupe in groupes|slice:"8"%}
            <div class="groupe flex items-center gap-4 bg-black px-4 min-h-[72px] py-2 justify-between">
              <div class="flex items-center gap-4">
                <div
                  class="bg-center bg-no-repeat aspect-square bg-cover rounded-full h-14 w-fit"
                  style='background-image: url("{{ groupe.group_pic }}");'
                ></div>
                <div class="flex flex-col justify-center">
                  <a href="{% url 'group' groupe.name %}" class="text-[#FFFFFF] text-base font-medium leading-normal line-clamp-1">{{ groupe.name }}</a>
                  <p class="text-[#CBCBCB] text-sm font-normal leading-normal line-clamp-2">{{groupe.description}}</p>
                </div>
              </div>
              <div class="shrink-0">
                <div class="text-[#FFFFFF] flex size-7 items-center justify-center" data-icon="DiscordLogo" data-size="24px" data-weight="regular">
                  <svg viewBox="0 0 350 350" style="color:currentColor" xmlns="http://www.w3.org/2000/svg" class="h-full w-full"><rect width="512" height="512" x="0" y="0" rx="30" fill="transparent" stroke="transparent" stroke-width="0" stroke-opacity="100%" paint-order="stroke"></rect><svg width="256px" height="256px" viewBox="0 0 24 24" fill="currentColor" x="128" y="128" role="img" style="display:inline-block;vertical-align:middle" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor"><path fill="currentColor" d="M10.27 12h3.46a1.5 1.5 0 0 0 1.48-1.75l-.3-1.79a2.951 2.951 0 0 0-5.82.01l-.3 1.79c-.15.91.55 1.74 1.48 1.74zm-8.61-.89c-.13.26-.18.57-.1.88c.16.69.76 1.03 1.53 1h1.95c.83 0 1.51-.58 1.51-1.29c0-.14-.03-.27-.07-.4c-.01-.03-.01-.05.01-.08c.09-.16.14-.34.14-.53c0-.31-.14-.6-.36-.82c-.03-.03-.03-.06-.02-.1c.07-.2.07-.43.01-.65a1.12 1.12 0 0 0-.99-.74a.09.09 0 0 1-.07-.03C5.03 8.14 4.72 8 4.37 8c-.3 0-.57.1-.75.26c-.03.03-.06.03-.09.02a1.24 1.24 0 0 0-1.7 1.03c0 .02-.01.04-.03.06c-.29.26-.46.65-.41 1.05c.03.22.12.43.25.6c.03.02.03.06.02.09zm14.58 2.54c-1.17-.52-2.61-.9-4.24-.9c-1.63 0-3.07.39-4.24.9A2.988 2.988 0 0 0 6 16.39V18h12v-1.61c0-1.18-.68-2.26-1.76-2.74zm-15.02.93A2.01 2.01 0 0 0 0 16.43V18h4.5v-1.61c0-.83.23-1.61.63-2.29c-.37-.06-.74-.1-1.13-.1c-.99 0-1.93.21-2.78.58zm21.56 0A6.95 6.95 0 0 0 20 14c-.39 0-.76.04-1.13.1c.4.68.63 1.46.63 2.29V18H24v-1.57c0-.81-.48-1.53-1.22-1.85zM22 11v-.5c0-1.1-.9-2-2-2h-2c-.42 0-.65.48-.39.81l.7.63c-.19.31-.31.67-.31 1.06c0 1.1.9 2 2 2s2-.9 2-2z"/></g></svg></svg>
                </div>
              </div>
            </div>
            {% endfor %}
          </div>
          </div>
        </div>
      </div>
    </div>
{% endblock %}
{% block extra_js %}
<script>
const elements = document.querySelectorAll('.flex.items-center.gap-3.px-3.py-2');

function addHoverStyle() {
  this.classList.add('rounded-full', 'bg-[#333333]');
}

function removeHoverStyle() {
  this.classList.remove('rounded-full', 'bg-[#333333]');
}

elements.forEach(element => {
  element.addEventListener('mouseover', addHoverStyle);
  element.addEventListener('mouseout', removeHoverStyle);
});


document.addEventListener('DOMContentLoaded', () => {
  const search = document.getElementById('search');
  const allGroupe = document.getElementById('allGroupe'); 
  const groupes = allGroupe.querySelectorAll('.groupe');

  search.addEventListener('input', (e) => {
    const value = e.target.value.toLowerCase();
    groupes.forEach(groupe => {
      const name = groupe.querySelector('.flex.flex-col.justify-center > a').textContent.toLowerCase();
      if (name.includes(value)) {
        groupe.style.display = 'flex';
      } else {
        groupe.style.display = 'none';
      }
    });
  });
});
</script>
<script>
  var require = { paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.26.1/min/vs' } };
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.26.1/min/vs/loader.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.26.1/min/vs/editor/editor.main.nls.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.26.1/min/vs/editor/editor.main.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>

  function initializeEditor() {
    monaco.editor.create(document.getElementById('code-editor'), {
        value: `{{ post.code|escapejs }}`,
        language: '{{ post.language }}',
        theme: 'vs-dark',
        readOnly: true
    });
}

document.addEventListener('DOMContentLoaded', function() {
    initializeEditor();
});

  function likePost(postId, userId) {
      var url = 'http://localhost:80/api/post/' + postId + '/add-like/';

      $.ajax({
          url: url,
          type: 'POST',
          headers: {
              'X-CSRFToken': '{{ csrf_token }}'
          },
          data: {
              'user_id': userId,
          },
          success: function(response) {
              $('#post-container').load(location.href + ' #post-container > *', function() {
                  initializeEditor();
              });
          },
          error: function(xhr, status, error) {
              console.log(xhr.responseText);
          }
      });
  }
</script>

{% endblock %}
